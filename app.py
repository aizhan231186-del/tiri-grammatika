import streamlit as st
import re

st.title("–¢—ñ—Ä—ñ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞")

# =========================================================
# 1) –°”©–∑–¥—ñ–∫: "—Å”©–∑ -> —Å”©–∑ —Ç–∞–±—ã"
# POS: PRON, NOUN, VERB, ADJ, ADV, NUM, PART, CONJ, POSTP, PROPN
# =========================================================
POS_KZ = {
    "PRON": "–ï—Å—ñ–º–¥—ñ–∫",
    "NOUN": "–ó–∞—Ç –µ—Å—ñ–º",
    "VERB": "–ï—Ç—ñ—Å—Ç—ñ–∫",
    "ADJ": "–°—ã–Ω –µ—Å—ñ–º",
    "ADV": "“Æ—Å—Ç–µ—É",
    "NUM": "–°–∞–Ω –µ—Å—ñ–º",
    "PART": "–®—ã–ª–∞—É",
    "CONJ": "–ñ–∞–ª“ì–∞—É–ª—ã“õ",
    "POSTP": "–°–µ–ø—Ç–µ—É–ª—ñ–∫",
    "PROPN": "–ñ–∞–ª“õ—ã –µ—Å—ñ–º"
}
DICTIONARY = {
    # –ï—Å—ñ–º–¥—ñ–∫—Ç–µ—Ä
    "–º–µ–Ω": "PRON",
    "—Å–µ–Ω": "PRON",
    "—Å—ñ–∑": "PRON",
    "–æ–ª": "PRON",
    "–±—ñ–∑": "PRON",
    "—Å–µ–Ω–¥–µ—Ä": "PRON",
    "—Å—ñ–∑–¥–µ—Ä": "PRON",
    "–æ–ª–∞—Ä": "PRON",
    "–∫”©–ø": "ADV",
    "–∂–∞—Å–∞": "VERB",
    "–∂“±–º—ã—Å": "NOUN",
    "–∞–π–∂–∞–Ω": "PROPN",
    "–∂–∞“õ—Å—ã": "ADJ",
    "–æ—Ç—ã—Ä": "VERB",
    "–±“Ø–≥—ñ–Ω":"ADV",
    "“õ–∞–∑–∞“õ": "NOUN",
"—Ç—ñ–ª": "NOUN",
"—Å–∞–±–∞“õ": "NOUN",
"“±–Ω–∞": "VERB",

    # “Æ—Å—Ç–µ—É–ª–µ—Ä
    "–∫–µ—à–µ": "ADV",
    "–µ—Ä—Ç–µ“£": "ADV",
    "“õ–∞–∑—ñ—Ä": "ADV",
    "–±“Ø–≥—ñ–Ω": "ADV",

    # –ó–∞—Ç –µ—Å—ñ–º–¥–µ—Ä
    "—Å–∞–±–∞“õ": "NOUN", 
    "–º–µ–∫—Ç–µ–ø": "NOUN",
    "“õ–∞–ª–∞": "NOUN",
    "–æ—Ç–±–∞—Å—ã": "NOUN",
    "–ø–æ–π—ã–∑": "NOUN",
    "–∫—ñ—Ç–∞–ø": "NOUN",
    "–∂“±–º—ã—Å": "NOUN",
     "–±–∞“ì–¥–∞—Ä–ª–∞–º–∞": "NOUN",
    "—Å–∞—è–±–∞“õ": "NOUN",
"–æ—Ä–∞–∑–∞": "NOUN",
"–∞–ª“ì–∞—à“õ—ã": "ADJ",
"–∫“Ø–Ω": "NOUN", 
"—Ç“Ø–Ω": "NOUN",
"–∫–æ–ª–ª–µ–¥–∂": "NOUN",
"–∞–ª“ì–∞—à“õ": "ADJ",
"–∞–π": "NOUN",
"–∫“Ø–Ω": "NOUN",
"–¥–æ—Å": "NOUN",
"—Å–µ—Ä—É–µ–Ω": "NOUN",
"–∞–π—ã": "NOUN",
    "–±–∞–ª–∞": "NOUN",
    "–¥–∞–ª–∞": "NOUN",
"—Å–µ—Ä—É–µ–Ω–¥–µ": "VERB",
    "–∂–µ–ª": "NOUN",
    "—Å—Ç—É–¥–µ–Ω—Ç": "NOUN",
    

    # –ñ–∞–ª“õ—ã –µ—Å—ñ–º–¥–µ—Ä (–º—ã—Å–∞–ª)
    "–∞–ª–º–∞—Ç—ã": "PROPN",
    "–∞—Å—Ç–∞–Ω–∞": "PROPN",
    "–¢–∞—Ä–∞–∑": "PRON",
    "“ö–∞–∑–∞“õ—Å—Ç–∞–Ω": "PRON",

    # –ï—Ç—ñ—Å—Ç—ñ–∫ —Ç“Ø–±—ñ—Ä–ª–µ—Ä—ñ
    "–±–∞—Ä": "VERB",
    "–∫–µ–ª": "VERB",
    "–∂“Ø—Ä": "VERB",
    "–∞–π—Ç": "VERB",
    "–∂–∞–∑": "VERB",
    "–æ“õ—ã": "VERB",
    "“õ–∞—Ç—ã—Å": "VERB",
    "“õ–∞—Ç—ã—Å—É": "VERB",
    "–±–æ–ª": "VERB",
    "–æ–π–Ω–∞": "VERB",
    
    # –°—ã–Ω –µ—Å—ñ–º —Ç“Ø–±—ñ—Ä–ª–µ—Ä—ñ
    "“õ—ã–∑—ã“õ": "ADJ",
    "“õ–∞—Ç—Ç—ã": "ADJ",
    "–∂“±–º—Å–∞“õ": "ADJ",
 } 
POS_KZ = {
    "NOUN": "–ó–∞—Ç –µ—Å—ñ–º",
    "ADJ": "–°—ã–Ω –µ—Å—ñ–º",
    "VERB": "–ï—Ç—ñ—Å—Ç—ñ–∫",
    "ADV": "“Æ—Å—Ç–µ—É",
    "PRON": "–ï—Å—ñ–º–¥—ñ–∫",
    "NUM": "–°–∞–Ω –µ—Å—ñ–º",
    "CONJ": "–®—ã–ª–∞—É (–∂–∞–ª“ì–∞—É–ª—ã“õ)",
    "POSTP": "–®—ã–ª–∞—É (—Å–µ–ø—Ç–µ—É–ª—ñ–∫)",
    "PART": "–î–µ–º–µ—É–ª—ñ–∫",
    "ADP": "–®—ã–ª–∞—É",
    "PROPN": "–ñ–∞–ª“õ—ã –µ—Å—ñ–º",
    "INTJ": "–û–¥–∞“ì–∞–π",
    "UNKNOWN": "–ë–µ–ª–≥—ñ—Å—ñ–∑",
}
 # ==============================
# –ö”ò–°–Ü–ë–ò MORPHO SUFFIX ARCHITECTURE
# ==============================

SUFFIX_GROUPS = {
    "plural": ["–ª–∞—Ä", "–ª–µ—Ä", "–¥–∞—Ä", "–¥–µ—Ä", "—Ç–∞—Ä", "—Ç–µ—Ä"],
    "poss_1sg": ["—ã–º","—ñ–º"],
    "poss_2sg": ["—ã“£","—ñ“£"],
    "poss_3sg": ["—ã","—ñ","—Å—ã","—Å—ñ"],
    "poss_1pl": ["—ã–º—ã–∑","—ñ–º—ñ–∑"],
    "poss_2pl": ["—Å—ã“£–¥–∞—Ä","—Å—ñ“£–¥–µ—Ä","—Å—ã“£—ã–∑","—Å—ñ“£—ñ–∑"],  # —ã“õ—à–∞–º–¥–∞–ø –∞–ª—É“ì–∞ –±–æ–ª–∞–¥—ã
    "genitive": ["–Ω—ã“£","–Ω—ñ“£","–¥—ã“£","–¥—ñ“£","—Ç—ã“£","—Ç—ñ“£"],
    "dative": ["“ì–∞","–≥–µ","“õ–∞","–∫–µ"],
    "accusative": ["–Ω—ã","–Ω—ñ","–¥—ã","–¥—ñ","—Ç—ã","—Ç—ñ"],
    "locative": ["–¥–∞","–¥–µ","—Ç–∞","—Ç–µ"],
    "ablative": ["–¥–∞–Ω","–¥–µ–Ω","—Ç–∞–Ω","—Ç–µ–Ω"],
    "instrumental": ["–º–µ–Ω","–ø–µ–Ω","–±–µ–Ω"],

    # –µ—Ç—ñ—Å—Ç—ñ–∫–∫–µ
    "past": [ 
          "–π–¥—ã", "–π–¥—ñ",
          "–¥—ã", "–¥—ñ", "—Ç—ã", "—Ç—ñ"
    ],                                      # –±–∞—Ä-–¥—ã-“õ
    "verb_personal_1pl": ["–º—ã–∑","–º—ñ–∑"],     # –±–∞—Ä-–¥—ã-“õ (–º“±–Ω–¥–∞ -“õ ”©–∑—ñ –∫”©–ø—Ç—ñ–∫ –∂–∞“õ)
    "converb": ["—ã–ø","—ñ–ø","–ø"],
    "participle": ["“ì–∞–Ω","–≥–µ–Ω","“õ–∞–Ω","–∫–µ–Ω"],
}
CASE_MAP = {
    "DAT": "–ë–∞—Ä—ã—Å —Å–µ–ø—Ç—ñ–∫",
    "GEN": "–Ü–ª—ñ–∫ —Å–µ–ø—Ç—ñ–∫",
    "ACC": "–¢–∞–±—ã—Å —Å–µ–ø—Ç—ñ–∫",
    "LOC": "–ñ–∞—Ç—ã—Å —Å–µ–ø—Ç—ñ–∫",
    "ABL": "–®—ã“ì—ã—Å —Å–µ–ø—Ç—ñ–∫",
    "INS": "–ö”©–º–µ–∫—Ç–µ—Å —Å–µ–ø—Ç—ñ–∫",
}

TENSE_MAP = {
    "past": "”®—Ç–∫–µ–Ω —à–∞“õ",
    "converb": "–ö”©—Å–µ–º—à–µ",
    "participle": "–ï—Å—ñ–º—à–µ",
}
def format_suffixes(suffixes):
    result = []
    for suf in suffixes:
        if suf in CASE_MAP:
            result.append(CASE_MAP[suf])
        elif suf in TENSE_MAP:
            result.append(TENSE_MAP[suf])
        else:
            result.append(suf)
    return " + ".join(result)

def detect_category(suffixes):
    categories = []

    for suf in suffixes:
        # 1) –°–µ–ø—Ç—ñ–∫ —Ç–µ–≥—Ç–µ—Ä—ñ (DAT, GEN...)
        if suf in CASE_MAP:
            categories.append(CASE_MAP[suf])

        # 2) –ï—Ç—ñ—Å—Ç—ñ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–µ–≥—Ç–µ—Ä—ñ (–µ–≥–µ—Ä –∫–µ–π—ñ–Ω –µ–Ω–≥—ñ–∑—Å–µ“£)
        elif suf in TENSE_MAP:
            categories.append(TENSE_MAP[suf])

        # 3) –¢”ô—É–µ–ª–¥—ñ–∫ (–±–µ—Ç–∫—ñ —Ñ–æ—Ä–º–∞ –∞—Ä“õ—ã–ª—ã)
        elif suf in ["—ã–º","—ñ–º","—ã“£","—ñ“£","—ã","—ñ","—Å—ã","—Å—ñ","—ã–º—ã–∑","—ñ–º—ñ–∑","—ã“£–¥–∞—Ä","—ñ“£–¥–µ—Ä"]:
            categories.append("–¢”ô—É–µ–ª–¥—ñ–∫ –∂–∞–ª“ì–∞—É")

        # 4) –ö”©–ø—Ç—ñ–∫
        elif suf in ["–ª–∞—Ä","–ª–µ—Ä","–¥–∞—Ä","–¥–µ—Ä","—Ç–∞—Ä","—Ç–µ—Ä"]:
            categories.append("–ö”©–ø—Ç—ñ–∫ –∂–∞–ª“ì–∞—É")

        # 5) –ï—Ç—ñ—Å—Ç—ñ–∫: –∞—É—ã—Å–ø–∞–ª—ã –æ—Å—ã —à–∞“õ (“±–Ω–∞–π-–¥—ã / –∫–µ–ª-–µ-–¥—ñ / –±–∞—Ä-–∞-–¥—ã)
        elif suf in ["–π–¥—ã","–π–¥—ñ","–∞–¥—ã","–µ–¥—ñ"]:
            categories.append("–ê—É—ã—Å–ø–∞–ª—ã –æ—Å—ã —à–∞“õ (3-–∂–∞“õ)")

    # “õ–∞–π—Ç–∞–ª–∞–Ω–±–∞—Å—ã–Ω –¥–µ—Å–µ“£:
    categories = list(dict.fromkeys(categories))

    return " + ".join(categories) if categories else "‚Äî"
# “ö–∞–∂–µ—Ç—Ç—ñ —Ç“Ø–±—ñ—Ä–ª–µ—Ä (—Å–∫—Ä–∏–Ω–¥–µ–≥—ñ —Å”©–π–ª–µ–º–≥–µ)
# –ë–∞—Ä–ª—ã“õ suffix-—Ç–µ—Ä–¥—ñ –±—ñ—Ä —Ç—ñ–∑—ñ–º–≥–µ –∂–∏–Ω–∞—É
SUFFIXES = []
for group in SUFFIX_GROUPS.values():
    SUFFIXES.extend(group)
DICTIONARY.update({
    "–±—ñ–∑": "PRON",      # –µ—Å—ñ–º–¥—ñ–∫
    "–¥–æ—Å": "NOUN",      # –∑–∞—Ç –µ—Å—ñ–º
    "–∂”ô–Ω–µ": "CONJ",     # –∂–∞–ª“ì–∞—É–ª—ã“õ
    "“±—Å—Ç–∞–∑": "NOUN",    # –∑–∞—Ç –µ—Å—ñ–º
    "–±—ñ—Ä–≥–µ": "ADV",     # “Ø—Å—Ç–µ—É
    "“õ—ã–∑—ã“õ": "ADJ",     # —Å—ã–Ω –µ—Å—ñ–º
    "”©—Ç": "VERB",       # –µ—Ç—ñ—Å—Ç—ñ–∫ (”©—Ç—ñ–ø)
    "–∂–∞—Ç—ã—Ä": "VERB",    # –µ—Ç—ñ—Å—Ç—ñ–∫ (–∂–∞—Ç—ã—Ä–º—ã–∑)
})

# =========================================================
# 2) “ö–æ—Å—ã–º—à–∞–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ (–∂–∏—ñ –∫–µ–∑–¥–µ—Å–µ—Ç—ñ–Ω)
# “∞–ó–´–ù–î–ê–†–´–ù –∞–ª“ì–∞ “õ–æ–π–¥—ã“õ ‚Äî –¥“±—Ä—ã—Å –±”©–ª—É “Ø—à—ñ–Ω!
# =========================================================
SUFFIXES = [
    # –ö”©–ø—Ç—ñ–∫
    "–ª–∞—Ä—ã", "–ª–µ—Ä—ñ", "–¥–∞—Ä—ã", "–¥–µ—Ä—ñ", "—Ç–∞—Ä—ã", "—Ç–µ—Ä—ñ",
    "–ª–∞—Ä", "–ª–µ—Ä", "–¥–∞—Ä", "–¥–µ—Ä", "—Ç–∞—Ä", "—Ç–µ—Ä",

    # –¢”ô—É–µ–ª–¥—ñ–∫ (–∂–∏—ñ)
    "—ã–º—ã–∑", "—ñ–º—ñ–∑",
    "–ª–∞—Ä—ã", "–ª–µ—Ä—ñ",
    "—ã–º", "—ñ–º", "–º",
    "—ã“£", "—ñ“£", "“£",
    "—ã", "—ñ", "—Å—ã", "—Å—ñ",

    # –Ü–ª—ñ–∫ —Å–µ–ø—Ç—ñ–∫
    "–Ω—ã“£", "–Ω—ñ“£", "–¥—ã“£", "–¥—ñ“£", "—Ç—ã“£", "—Ç—ñ“£",

    # –ë–∞—Ä—ã—Å —Å–µ–ø—Ç—ñ–∫
    "“ì–∞", "–≥–µ", "“õ–∞", "–∫–µ",

    # –¢–∞–±—ã—Å —Å–µ–ø—Ç—ñ–∫
    "–Ω—ã", "–Ω—ñ", "–¥—ã", "–¥—ñ", "—Ç—ã", "—Ç—ñ",

    # –ñ–∞—Ç—ã—Å —Å–µ–ø—Ç—ñ–∫
    "–¥–∞", "–¥–µ", "—Ç–∞", "—Ç–µ",
    "—ñ–Ω–¥–µ" "—ã–Ω–¥–∞",
    "–Ω–¥–µ", "–Ω–¥–∞"

    # –®—ã“ì—ã—Å —Å–µ–ø—Ç—ñ–∫
    "–¥–∞–Ω", "–¥–µ–Ω", "—Ç–∞–Ω", "—Ç–µ–Ω", "–Ω–∞–Ω", "–Ω–µ–Ω",

    # –ö”©–º–µ–∫—Ç–µ—Å —Å–µ–ø—Ç—ñ–∫
    "–º–µ–Ω", "–ø–µ–Ω", "–±–µ–Ω",

    # –ï—Ç—ñ—Å—Ç—ñ–∫ –∂—ñ–∫—Ç—ñ–∫/—à–∞“õ (”©—Ç–µ –∂–∏—ñ, –∂–µ“£—ñ–ª “Ø–ª–≥—ñ)
    "–º—ã–Ω", "–º—ñ–Ω", "–±—ã–∑", "–±—ñ–∑",
    "—Å—ã“£", "—Å—ñ“£", "—Å—ã–∑", "—Å—ñ–∑",
    "–¥—ã", "–¥—ñ", "—Ç—ã", "—Ç—ñ","–¥—ã–º", "–¥—ñ–º", "—Ç—ã–º", "—Ç—ñ–º",# –∫”©—Å–µ–º—à–µ (”©—Ç—ñ–ø, –±–∞—Ä—ã–ø...)
"—ã–ø", "—ñ–ø", "–ø",

# –∂—ñ–∫—Ç—ñ–∫ –∂–∞–ª“ì–∞—É (–∂–∞—Ç—ã—Ä–º—ã–∑, –±–∞—Ä–∞–º—ã–∑...)
"–º—ã–∑", "–º—ñ–∑", "–±—ã–∑", "–±—ñ–∑",
"–¥—ã“õ", "–¥—ñ–∫", "—Ç—ñ–∫", "—Ç—ã“õ",
]

# =========================================================
# –ö”©–º–µ–∫—à—ñ —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä
# =========================================================
def normalize_word(w: str) -> str:
    """–¢—ã–Ω—ã—Å –±–µ–ª–≥—ñ–ª–µ—Ä—ñ–Ω –∞–ª—ã–ø, —Ç”©–º–µ–Ω–≥—ñ —Ä–µ–≥–∏—Å—Ç—Ä–≥–µ —Ç“Ø—Å—ñ—Ä—É"""
    w = w.strip()
    w = re.sub(r"[^\w”ô—ñ“£“ì“Ø“±“õ”©“ª”ò–Ü“¢“í“Æ“∞“ö”®“∫-]", "", w)  # “õ–∞–∑–∞“õ ”ô—Ä—ñ–ø—Ç–µ—Ä—ñ–Ω —Å–∞“õ—Ç–∞–π–º—ã–∑
    return w.lower()
def layered_split(word: str, dictionary: dict):
    """–¢“Ø–±—ñ—Ä + “õ–æ—Å—ã–º—à–∞–Ω—ã “õ–∞–±–∞—Ç—Ç–∞–ø –±”©–ª—É (–∞—Ä–∞–ª—ã“õ —Ñ–æ—Ä–º–∞–ª–∞—Ä —Å”©–∑–¥—ñ–∫—Ç–µ –±–æ–ª–º–∞—Å–∞ –¥–∞ –∫–µ—Å–µ–¥—ñ)."""
    w = normalize_word(word)
    SPECIAL_FORMS = {
        "–º–∞“ì–∞–Ω": ("–º–µ–Ω", ["DAT"]),
        "—Å–∞“ì–∞–Ω": ("—Å–µ–Ω", ["DAT"]),
        "–æ“ì–∞–Ω": ("–æ–ª",  ["DAT"]),
    }

    # —Ç“Ø–±—ñ—Ä–¥—ñ —Ç–∞–±–∞—Ç—ã–Ω —Ñ—É–Ω–∫—Ü–∏—è–Ω—ã“£ –±–∞—Å—ã–Ω–∞:
    w = word.lower()
    if w in SPECIAL_FORMS:
        return SPECIAL_FORMS[w][0], SPECIAL_FORMS[w][1]
    found = []

    # –†–µ—Ç—Ç—ñ–∫ —Å–∞–Ω –µ—Å—ñ–º –∂“±—Ä–Ω–∞“ì—ã–Ω –±”©–ª–º–µ–π–º—ñ–∑ (–µ–∫—ñ–Ω—à—ñ, “Ø—à—ñ–Ω—à—ñ...)
    if w.endswith(("—ñ–Ω—à—ñ", "–Ω—à—ã")):
        return w, []

    # –ë–∞—Ä–ª—ã“õ “õ–æ—Å—ã–º—à–∞–ª–∞—Ä–¥—ã SUFFIX_GROUPS-—Ç–µ–Ω –∂–∏–Ω–∞–π–º—ã–∑
    all_suffixes = []
    for group_name, group in SUFFIX_GROUPS.items():
        all_suffixes.extend(group)

    # “∞–∑—ã–Ω “õ–æ—Å—ã–º—à–∞ –∞–ª–¥—ã–º–µ–Ω —Ç–µ–∫—Å–µ—Ä—ñ–ª—Å—ñ–Ω
    suffixes = sorted(set(all_suffixes), key=len, reverse=True)

    changed = True
    while changed:
        changed = False

        if w in dictionary:
            break

        for suf in suffixes:
            if w.endswith(suf) and len(w) > len(suf) + 1:
                cand = w[:-len(suf)]

                # üî• “õ/–∫ -> “ì/–≥ –±–æ–ª—ã–ø ”©–∑–≥–µ—Ä–≥–µ–Ω—ñ–Ω –∫–µ—Ä—ñ “õ–∞–π—Ç–∞—Ä—É (–∫”©–±—ñ–Ω–µ —Ç”ô—É–µ–ª–¥—ñ–∫: —ã/—ñ)
                if suf in ("—ã", "—ñ"):
                    if cand.endswith("“ì"):
                        cand = cand[:-1] + "“õ"
                    elif cand.endswith("–≥"):
                        cand = cand[:-1] + "–∫"

                w = cand
                found.insert(0, suf)
                changed = True
                break

    # üî• –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî while –ë–Ü–¢–ö–ï–ù–ù–ï–ù –ö–ï–ô–Ü–ù
    if w.endswith("–π"):
        w = w[:-1]

    return w, found

def guess_pos(root: str, suffixes_found: list[str]) -> str:
    """–°”©–∑ —Ç–∞–±—ã–Ω –∂—É—ã“õ—Ç–∞—É"""

    if root in DICTIONARY:
        return DICTIONARY[root]

    # –†–µ—Ç—Ç—ñ–∫ —Å–∞–Ω –µ—Å—ñ–º
    if root.endswith(("—ñ–Ω—à—ñ", "–Ω—à—ã")):
        return "NUM"

    # –ï–≥–µ—Ä –∂—ñ–∫—Ç—ñ–∫ –∂–∞–ª“ì–∞—É –±–æ–ª—Å–∞
    verb_like = {"–º—ã–Ω", "–º—ñ–Ω", "–±—ã–∑", "–±—ñ–∑", "—Å—ã“£", "—Å—ñ“£"}
    if any(s in verb_like for s in suffixes_found):
        return "VERB"
    # –ö”©–ø—Ç—ñ–∫ –∂–∞–ª“ì–∞—É -> –∑–∞—Ç –µ—Å—ñ–º
    if any(s in ["–ª–∞—Ä","–ª–µ—Ä","–¥–∞—Ä","–¥–µ—Ä","—Ç–∞—Ä","—Ç–µ—Ä"] for s in sufs):
        return "NOUN"

    # –ñ–∞—Ç—ã—Å —Å–µ–ø—Ç—ñ–∫ -> –∫”©–±—ñ–Ω–µ –∑–∞—Ç –µ—Å—ñ–º (–¥–∞–ª–∞–¥–∞, –º–µ–∫—Ç–µ–ø—Ç–µ)
    if any(s in ["–¥–∞","–¥–µ","—Ç–∞","—Ç–µ"] for s in sufs):
        return "NOUN"

    # –ö”©—Å–µ–º—à–µ -> –µ—Ç—ñ—Å—Ç—ñ–∫ (–æ–π–Ω–∞–ø/–æ“õ—ã–ø/–∫–µ–ª—ñ–ø)
    if any(s in ["–ø","—ã–ø","—ñ–ø"] for s in sufs):
        return "VERB"
    return "UNKNOWN"
    def extract_features(pos: str, suffixes: list[str]) -> dict:
        feats = {}

        # NOUN features
        if pos == "NOUN":
            if any(s in SUFFIX_GROUPS["plural"] for s in suffixes):
                feats["Number"] = "Plur"
        if any(s in SUFFIX_GROUPS["poss_1pl"] for s in suffixes):
            feats["Poss"] = "1Pl"
        elif any(s in SUFFIX_GROUPS["poss_1sg"] for s in suffixes):
            feats["Poss"] = "1Sg"
        elif any(s in SUFFIX_GROUPS["poss_2sg"] for s in suffixes):
            feats["Poss"] = "2Sg"
        elif any(s in SUFFIX_GROUPS["poss_3sg"] for s in suffixes):
            feats["Poss"] = "3Sg"

        if any(s in SUFFIX_GROUPS["genitive"] for s in suffixes):
            feats["Case"] = "Gen"
        elif any(s in SUFFIX_GROUPS["dative"] for s in suffixes):
            feats["Case"] = "Dat"
        elif any(s in SUFFIX_GROUPS["accusative"] for s in suffixes):
            feats["Case"] = "Acc"
        elif any(s in SUFFIX_GROUPS["locative"] for s in suffixes):
            feats["Case"] = "Loc"
        elif any(s in SUFFIX_GROUPS["ablative"] for s in suffixes):
            feats["Case"] = "Abl"
        elif any(s in SUFFIX_GROUPS["instrumental"] for s in suffixes):
            feats["Case"] = "Ins"

    # VERB features
    if pos == "VERB":
        if any(s in SUFFIX_GROUPS["past"] for s in suffixes):
            feats["Tense"] = "Past"

    return feats

    # –ö”©–ø—Ç—ñ–∫/—Å–µ–ø—Ç—ñ–∫ –∫”©–ø –±–æ–ª—Å–∞ ‚Üí –∑–∞—Ç –µ—Å—ñ–º –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω
    noun_like = {"–ª–∞—Ä", "–ª–µ—Ä", "–¥–∞—Ä", "–¥–µ—Ä", "—Ç–∞—Ä", "—Ç–µ—Ä", "“ì–∞", "–≥–µ", "“õ–∞", "–∫–µ", "–¥–∞", "–¥–µ", "—Ç–∞", "—Ç–µ", "–¥–∞–Ω", "–¥–µ–Ω", "—Ç–∞–Ω", "—Ç–µ–Ω", "–º–µ–Ω", "–ø–µ–Ω", "–±–µ–Ω"}
    if any(s in noun_like for s in suffixes_found):
        return "NOUN"
# –†–µ—Ç—Ç—ñ–∫ —Å–∞–Ω –µ—Å—ñ–º–¥–µ—Ä (-–Ω—à—ã/-–Ω—à—ñ/-—ã–Ω—à—ã/-—ñ–Ω—à—ñ)
    ordinal_like = {"–Ω—à—ã", "–Ω—à—ñ", "—ã–Ω—à—ã", "—ñ–Ω—à—ñ"}
    if any(s in ordinal_like for s in suffixes_found):
        return "NUM"
# –ñ–∞—Ç—ã—Å —Å–µ–ø—Ç—ñ–≥—ñ (-–Ω–¥–∞/-–Ω–¥–µ/-—ã–Ω–¥–∞/-—ñ–Ω–¥–µ)
    locative_like = {"–Ω–¥–∞", "–Ω–¥–µ", "—ã–Ω–¥–∞", "—ñ–Ω–¥–µ"}
    if any(s in locative_like for s in suffixes_found):
        return "NOUN"
 # –¢—É—ã–Ω–¥—ã –∑–∞—Ç –µ—Å—ñ–º (-–ª—ã“õ/-–ª—ñ–∫/-–¥—ã“õ/-–¥—ñ–∫/-—Ç—ã“õ/-—Ç—ñ–∫)
    noun_deriv = {"–ª—ã“õ", "–ª—ñ–∫", "–¥—ã“õ", "–¥—ñ–∫", "—Ç—ã“õ", "—Ç—ñ–∫"}
    if any(s in noun_deriv for s in suffixes_found):
        return "NOUN"       
    return "UNKNOWN"

def find_last_verb_index(items: list[dict]) -> int:
    """–°”©–π–ª–µ–º–¥–µ–≥—ñ —Å–æ“£“ì—ã –µ—Ç—ñ—Å—Ç—ñ–∫ –∏–Ω–¥–µ–∫—Å—ñ–Ω —Ç–∞–±—É"""
    idx = -1
    for i, it in enumerate(items):
        if it["pos"] == "VERB":
            idx = i
    return idx
def guess_role(pos: str, suffixes_found: list[str], index: int, last_verb_index: int, items: list[dict]) -> str:
    # –ë–∞—è–Ω–¥–∞—É—ã—à ‚Äî —Å–æ“£“ì—ã –µ—Ç—ñ—Å—Ç—ñ–∫
    if pos == "VERB" and index == last_verb_index:
        return "–ë–∞—è–Ω–¥–∞—É—ã—à"
    # –ï–≥–µ—Ä –µ–∫—ñ –µ—Ç—ñ—Å—Ç—ñ–∫ “õ–∞—Ç–∞—Ä –∫–µ–ª—Å–µ (–æ–π–Ω–∞–ø –∂“Ø—Ä, –±–∞—Ä—ã–ø –∫–µ–ª–¥—ñ) -> –∫“Ø—Ä–¥–µ–ª—ñ –±–∞—è–Ω–¥–∞—É—ã—à
    if pos == "VERB" and index < last_verb_index and index + 1 < len(items):
        if items[index + 1]["pos"] == "VERB":
           return "–ë–∞—è–Ω–¥–∞—É—ã—à"
    # –ï–≥–µ—Ä –∑–∞—Ç –µ—Å—ñ–º–Ω—ñ“£ –∞–ª–¥—ã–Ω–¥–∞ —Ç–∞“ì—ã –∑–∞—Ç –µ—Å—ñ–º —Ç“±—Ä—Å–∞ ‚Üí –∞–Ω—ã“õ—Ç–∞—É—ã—à
    if pos == "NOUN" and index + 1 < len(items):
        if items[index + 1]["pos"] == "NOUN":
            return "–ê–Ω—ã“õ—Ç–∞—É—ã—à"
    # –ï–≥–µ—Ä —Å–æ“£“ì—ã –µ—Ç—ñ—Å—Ç—ñ–∫—Ç—ñ“£ –∞–ª–¥—ã–Ω–¥–∞ —Ç“±—Ä“ì–∞–Ω –∑–∞—Ç –µ—Å—ñ–º –±–æ–ª—Å–∞ ‚Üí –±–∞—Å—Ç–∞—É—ã—à
    if (
        pos == "NOUN"
        and index == last_verb_index - 1
        and "DAT" not in suffixes_found
    ):
        return "–ë–∞—Å—Ç–∞—É—ã—à" 

    # –ï–≥–µ—Ä DAT –±–æ–ª—Å–∞ ‚Äî —Ç–æ–ª—ã“õ—Ç–∞—É—ã—à (–º–∞“ì–∞–Ω/—Å–∞“ì–∞–Ω/–æ“ì–∞–Ω)
    if "DAT" in suffixes_found:
        return "–¢–æ–ª—ã“õ—Ç–∞—É—ã—à"

    # –ë–∞—Å—Ç–∞—É—ã—à ‚Äî —Å”©–π–ª–µ–º –±–∞—Å—ã–Ω–¥–∞“ì—ã –µ—Å—ñ–º–¥—ñ–∫/–∑–∞—Ç –µ—Å—ñ–º (DAT –±–æ–ª–º–∞—Å—ã–Ω)
    if index == 0 and pos in ("PRON", "NOUN", "PROPN") and "DAT" not in suffixes_found:
        return "–ë–∞—Å—Ç–∞—É—ã—à"  

    # –°—ã–Ω –µ—Å—ñ–º –∑–∞—Ç –µ—Å—ñ–º–Ω—ñ“£ –∞–ª–¥—ã–Ω–¥–∞ —Ç“±—Ä—Å–∞ -> –∞–Ω—ã“õ—Ç–∞—É—ã—à (“õ–æ—Ä“ì–∞–Ω—ã—Å: index+1 —à–µ–∫—Ç–µ–Ω –∞—Å–ø–∞—Å—ã–Ω)
    if pos == "ADJ" and index + 1 < len(items):
        if items[index + 1]["pos"] in ("NOUN", "PROPN"):
            return "–ê–Ω—ã“õ—Ç–∞—É—ã—à"
    # –ñ–∞—Ç—ã—Å —Å–µ–ø—Ç—ñ–∫ (–¥–∞/–¥–µ/—Ç–∞/—Ç–µ) -> –ø—ã—Å—ã“õ—Ç–∞—É—ã—à
    if any(s in {"–¥–∞","–¥–µ","—Ç–∞","—Ç–µ"} for s in suffixes_found):
        return "–ü—ã—Å—ã“õ—Ç–∞—É—ã—à"

    # –¢–æ–ª—ã“õ—Ç–∞—É—ã—à ‚Äî —Ç–∞–±—ã—Å/–±–∞—Ä—ã—Å —Å–µ–ø—Ç—ñ–∫
    object_suffixes = {"–Ω—ã", "–Ω—ñ", "“ì–∞", "–≥–µ", "“õ–∞", "–∫–µ",}
    if any(s in object_suffixes for s in suffixes_found):
        return "–¢–æ–ª—ã“õ—Ç–∞—É—ã—à"

    # –ü—ã—Å—ã“õ—Ç–∞—É—ã—à ‚Äî “Ø—Å—Ç–µ—É
    if pos == "ADV":
        return "–ü—ã—Å—ã“õ—Ç–∞—É—ã—à"

    return "–ë–µ–ª–≥—ñ—Å—ñ–∑"
def extract_features(pos, sufs):
    return {}

# =========================================================
# UI
# =========================================================
text = st.text_input("–°”©–π–ª–µ–º –∂–∞–∑—ã“£—ã–∑:")

if text:
    st.write("–°—ñ–∑ –∂–∞–∑–¥—ã“£—ã–∑:", text)
    raw_words = text.split()
    analysis = []

    # ”ò—Ä —Å”©–∑–¥—ñ —Ç–∞–ª–¥–∞—É
    for w in raw_words:
        root, sufs = layered_split(w, DICTIONARY)
        pos = guess_pos(root, sufs)
        feats = extract_features(pos, sufs)   

        analysis.append({
            "orig": w,
            "root": root,
            "suffixes": sufs,
            "pos": pos,
            "feats": feats,                  
        })
    last_verb_index = find_last_verb_index(analysis)

    table = []
    for i, it in enumerate(analysis):
        role = guess_role(it["pos"], it["suffixes"], i, last_verb_index, analysis)

        suf_text = "+".join(it["suffixes"]) if it["suffixes"] else "‚Äî"
        category_text = detect_category(it["suffixes"])   # ‚úÖ –ú–Ü–ù–ï –û–°–´
        pos_text = POS_KZ.get(it["pos"], it["pos"])

        table.append({
            "–°”©–∑": it["orig"],
            "–¢“Ø–±—ñ—Ä": it["root"] if it["root"] else "‚Äî",
            "“ö–æ—Å—ã–º—à–∞(–ª–∞—Ä)": suf_text,
            "–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞–ª—ã“õ –∫–∞—Ç–µ–≥–æ—Ä–∏—è": category_text,      # ‚úÖ –ñ–ê“¢–ê –ë–ê“í–ê–ù
            "–°”©–∑ —Ç–∞–±—ã": pos_text,
            "–°”©–π–ª–µ–º –º“Ø—à–µ—Å—ñ": role
    })

    st.subheader("–¢–∞–ª–¥–∞—É –Ω”ô—Ç–∏–∂–µ—Å—ñ")
    st.table(table)

    # “ö–∞—Ç–µ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω —Å”©–∑–¥–µ—Ä (—Ç“Ø–±—ñ—Ä —Å”©–∑–¥—ñ–∫—Ç–µ –∂–æ“õ –±–æ–ª—Å–∞)
    st.subheader("–°”©–∑–¥—ñ–∫—Ç–µ –∂–æ“õ —Ç“Ø–±—ñ—Ä–ª–µ—Ä (“õ–∞—Ç–µ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω)")
    unknowns = [it for it in analysis if (it["root"] not in DICTIONARY)]
    if not unknowns:
        st.success("–ë–∞—Ä–ª—ã“õ —Ç“Ø–±—ñ—Ä–ª–µ—Ä —Å”©–∑–¥—ñ–∫—Ç–µ –±–∞—Ä —Å–∏—è“õ—Ç—ã ‚úÖ")
    else:
        for it in unknowns:
            st.warning(f"'{it['orig']}' ‚Üí —Ç“Ø–±—ñ—Ä—ñ '{it['root']}' (—Å”©–∑–¥—ñ–∫—Ç–µ –∂–æ“õ)")

        st.info("–ö–µ“£–µ—Å: —Ç”©–º–µ–Ω–¥–µ–≥—ñ DICTIONARY —ñ—à—ñ–Ω–µ –æ—Å—ã —Ç“Ø–±—ñ—Ä–ª–µ—Ä–¥—ñ “õ–æ—Å—ã–ø –∫”©—Ä—ñ“£—ñ–∑.")
































































































